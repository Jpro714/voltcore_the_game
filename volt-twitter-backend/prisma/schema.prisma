generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum NotificationType {
  like
  reply
  follow
}

model User {
  id            String         @id @default(uuid())
  handle        String         @unique
  displayName   String
  avatar        String
  tagline       String?
  bio           String?
  location      String?
  posts         Post[]
  notifications Notification[] @relation("NotificationRelatedUser")
  profile       Profile?
  followers     Follow[]       @relation("UserFollowers")
  following     Follow[]       @relation("UserFollowing")
}

model Post {
  id        String   @id @default(uuid())
  content   String
  createdAt DateTime @default(now())
  likes     Int      @default(0)
  replies   Int      @default(0)
  reposts   Int      @default(0)
  isPinned  Boolean  @default(false)
  authorId  String
  author    User     @relation(fields: [authorId], references: [id])
  pinnedFor Profile? @relation("ProfilePinnedPost")
  parentPostId String?
  parent       Post?    @relation("PostReplies", fields: [parentPostId], references: [id])
  repliesList  Post[]   @relation("PostReplies")
}

model Notification {
  id            String           @id @default(uuid())
  type          NotificationType
  message       String
  createdAt     DateTime         @default(now())
  relatedUserId String
  relatedUser   User             @relation("NotificationRelatedUser", fields: [relatedUserId], references: [id])
}

model TrendingTopic {
  id          String @id @default(uuid())
  hashtag     String @unique
  posts       Int
  description String?
}

model Profile {
  id           String  @id @default(uuid())
  userId       String  @unique
  bio          String
  location     String?
  followers    Int     @default(0)
  following    Int     @default(0)
  posts        Int     @default(0)
  pinnedPostId String? @unique
  user         User    @relation(fields: [userId], references: [id])
  pinnedPost   Post?   @relation("ProfilePinnedPost", fields: [pinnedPostId], references: [id])
}

model Follow {
  id          String @id @default(uuid())
  followerId  String
  followingId String
  follower    User   @relation("UserFollowing", fields: [followerId], references: [id])
  following   User   @relation("UserFollowers", fields: [followingId], references: [id])

  @@unique([followerId, followingId])
}
